# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要

これはシンプルな画面録画用Chrome拡張機能です。PC画面、特定のウィンドウ、またはブラウザタブをWeb MediaDevices APIを使用して録画できます。

## アーキテクチャ

拡張機能の構成:
- `manifest.json`: Chrome拡張機能マニフェスト (v3) - 拡張機能のメタデータと権限を定義
- `popup.html`: 録画コントロール付きの拡張機能ポップアップUI（改善されたUI/UX）
- `popup.js`: アプリケーションのエントリーポイント、モジュールを初期化
- `recorder.js`: ScreenRecorderクラス - 録画ロジックのコア部分（MediaRecorder API）
- `ui-controller.js`: UIControllerクラス - UI状態管理とユーザーインタラクション処理
- `styles.css`: モダンなスタイリング（ダークモード対応）
- `icon.png`: 拡張機能アイコン
- `background.js`: サービスワーカー - 録画状態の永続化と通知管理
- `content-script.js`: 録画中インジケーター表示（黄色い枠）
- `settings.js`: 設定管理（chrome.storage.local使用）
- `download-manager.js`: 自動ダウンロード機能の管理
- `audio-feedback.js`: 音声フィードバック（録画開始/停止音）

## 実装の詳細

### 画面録画のフロー
1. ユーザーがpopup.html:20の「録画開始」ボタンをクリック
2. UIController.handleStart()がScreenRecorder.startRecording()を呼び出す
3. recorder.js:27で`getDisplayMedia()`を呼び出し、画面/ウィンドウ/タブの選択を促す
4. MediaRecorderがビデオ/オーディオストリームをキャプチャ（品質設定対応）
5. ユーザーが「録画停止」ボタンをクリックすると録画停止
6. 録画されたビデオはWebM形式で保存され、ダウンロードリンクが作成される

### 重要なコードパターン
- クラスベースの設計でコードを構造化（ScreenRecorder、UIController）
- 包括的なエラーハンドリングとユーザーフィードバック
- 状態管理の改善（recording、ready、starting、stopping）
- 録画設定のカスタマイズ機能（画質、音声）
- リソースリークを防ぐ自動クリーンアップ機能
- ダークモード対応のモダンなUI
- バックグラウンドサービスワーカーによる状態永続化
- chrome.storage.localを使用した設定保存

### 主な機能
- 画面全体、ウィンドウ、またはタブの録画
- 音声録音のON/OFF切り替え
- 画質選択（高/中/低）
- WebM形式での保存
- 自動ダウンロード機能
- ダウンロード先フォルダの指定（サブフォルダ）
- デスクトップ通知（録画中も最小化時に確認可能）
- 拡張機能アイコンバッジ（REC表示）
- 音声フィードバック（録画開始/停止音）
- 録画中インジケーター（黄色い枠）

### ビルドコマンド
特にビルドは必要ありません。Chrome拡張機能として直接読み込むことができます。

## 開発コマンド

この拡張機能はビルドプロセスがないシンプルな構成です。テスト方法:
1. Chromeを開き `chrome://extensions/` にアクセス
2. 「デベロッパーモード」を有効化
3. 「パッケージ化されていない拡張機能を読み込む」をクリックし、このディレクトリを選択
4. ツールバーにアイコン付きで拡張機能が表示される

## テスト

自動テストは設定されていません。手動テスト手順:
1. 拡張機能をアンパックで読み込む
2. 拡張機能アイコンをクリックしてポップアップを開く
3. 異なるキャプチャソースで録画機能をテスト
4. ブラウザ最小化時の通知確認
5. 自動ダウンロード機能のテスト
6. 設定の永続化確認

## 既知の制限事項
- Chrome拡張機能の制約により、ファイルエクスプローラーでフォルダを選択することはできません
- MP4への自動変換はブラウザ環境では利用できません（WebMのみサポート）
- 録画中にポップアップを閉じても録画は継続されます（バックグラウンド処理）